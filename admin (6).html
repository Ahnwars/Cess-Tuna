<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cess Tuna ‚Äî Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --red: #E8272B;
    --yellow: #FFD600;
    --dark: #111111;
    --gray: #1C1C1C;
    --light: #F5F0E8;
    --muted: #888;
    --green: #22c55e;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--dark); color: var(--light); font-family: 'DM Sans', sans-serif; min-height: 100vh; }

  /* HEADER */
  header {
    background: #0d0d0d;
    border-bottom: 3px solid var(--red);
    padding: 20px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 50;
  }
  .admin-logo { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; letter-spacing: 3px; color: var(--yellow); text-shadow: 2px 2px 0 var(--red); }
  .admin-logo span { color: var(--muted); font-size: 1rem; font-family: 'DM Sans', sans-serif; letter-spacing: 1px; font-weight: 400; margin-left: 12px; vertical-align: middle; }
  .view-site-btn { background: none; border: 2px solid #333; color: var(--muted); padding: 9px 20px; border-radius: 4px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 0.85rem; letter-spacing: 1px; text-transform: uppercase; transition: all 0.2s; text-decoration: none; display: inline-block; }
  .view-site-btn:hover { border-color: var(--yellow); color: var(--yellow); }

  /* LAYOUT */
  .admin-body { display: grid; grid-template-columns: 340px 1fr; gap: 0; min-height: calc(100vh - 73px); }

  /* SIDEBAR */
  .sidebar {
    background: #0d0d0d;
    border-right: 1px solid #1e1e1e;
    padding: 30px 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* KILL SWITCH CARD */
  .kill-card {
    background: #161616;
    border: 2px solid #2a0000;
    border-radius: 10px;
    padding: 22px;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .kill-card.shutdown {
    border-color: var(--red);
    box-shadow: 0 0 24px rgba(232,39,43,0.2);
    animation: dangerPulse 2.5s infinite;
  }
  @keyframes dangerPulse {
    0%,100% { box-shadow: 0 0 10px rgba(232,39,43,0.15); }
    50%      { box-shadow: 0 0 28px rgba(232,39,43,0.4); }
  }

  .kill-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
    color: var(--red);
    margin-bottom: 6px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .kill-desc {
    font-size: 0.78rem;
    color: var(--muted);
    line-height: 1.5;
    margin-bottom: 18px;
  }

  .kill-desc.danger { color: #ff6b6b; font-weight: 600; }

  /* BIG RED/GREEN SWITCH BUTTON */
  .big-switch {
    width: 100%;
    padding: 14px;
    border-radius: 8px;
    border: none;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.25s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }
  .big-switch.online { background: #14532d; color: #4ade80; border: 2px solid #166534; }
  .big-switch.online:hover { background: #166534; }
  .big-switch.offline { background: #7f1d1d; color: #fca5a5; border: 2px solid var(--red); }
  .big-switch.offline:hover { background: #991b1b; }

  /* CONFIRM BOX */
  .confirm-box {
    display: none;
    margin-top: 14px;
    background: #1a0505;
    border: 1px solid #5a0000;
    border-radius: 8px;
    padding: 14px;
  }
  .confirm-box p { font-size: 0.82rem; color: #ff8080; font-weight: 600; margin-bottom: 12px; line-height: 1.5; }
  .confirm-btns { display: flex; gap: 8px; }
  .confirm-yes { flex: 1; background: var(--red); color: #fff; border: none; padding: 10px; border-radius: 4px; font-weight: 700; cursor: pointer; font-family: 'DM Sans', sans-serif; font-size: 0.85rem; transition: background 0.2s; }
  .confirm-yes:hover { background: #c41e21; }
  .confirm-no  { flex: 1; background: #2a2a2a; color: var(--light); border: none; padding: 10px; border-radius: 4px; font-weight: 700; cursor: pointer; font-family: 'DM Sans', sans-serif; font-size: 0.85rem; transition: background 0.2s; }
  .confirm-no:hover  { background: #3a3a3a; }

  /* STATUS INDICATOR */
  .status-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-top: 14px;
  }
  .status-pill.live    { background: rgba(34,197,94,0.12); color: #4ade80; border: 1px solid #166534; }
  .status-pill.down    { background: rgba(232,39,43,0.12); color: #f87171; border: 1px solid #7f1d1d; }
  .status-dot { width: 8px; height: 8px; border-radius: 50%; }
  .status-dot.live { background: #4ade80; box-shadow: 0 0 8px #4ade80; animation: blink 1.5s infinite; }
  .status-dot.down { background: var(--red); box-shadow: 0 0 8px var(--red); }
  @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }

  /* STATS CARD */
  .stats-card {
    background: #161616;
    border: 1px solid #2a2a2a;
    border-radius: 10px;
    padding: 18px 22px;
  }
  .stats-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; color: var(--muted); margin-bottom: 10px; }
  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .stat-item { text-align: center; }
  .stat-num { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; color: var(--yellow); line-height: 1; }
  .stat-label { font-size: 0.7rem; color: var(--muted); margin-top: 2px; }

  /* ORDERS PANEL */
  .orders-panel { padding: 30px 32px; overflow-y: auto; }
  .panel-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
  .panel-title { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; letter-spacing: 3px; }
  .panel-title span { color: var(--red); }
  .refresh-btn { background: #1e1e1e; border: 1px solid #2a2a2a; color: var(--muted); padding: 8px 16px; border-radius: 4px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 0.8rem; letter-spacing: 1px; text-transform: uppercase; transition: all 0.2s; }
  .refresh-btn:hover { border-color: var(--yellow); color: var(--yellow); }

  .no-orders { text-align: center; color: var(--muted); padding: 80px 20px; font-size: 1rem; }
  .no-orders-icon { font-size: 3.5rem; margin-bottom: 14px; }

  .order-card {
    background: #161616;
    border: 1px solid #2a2a2a;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 16px;
    animation: fadeUp 0.3s ease both;
    position: relative;
    transition: border-color 0.2s;
  }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  .order-card.new-order { border-color: var(--yellow); }
  .oc-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
  .oc-id { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 1px; color: var(--yellow); }
  .oc-time { font-size: 0.78rem; color: var(--muted); }
  .oc-customer { font-weight: 600; margin-bottom: 4px; }
  .oc-address { font-size: 0.85rem; color: var(--muted); margin-bottom: 12px; }
  .oc-items { font-size: 0.9rem; line-height: 1.8; margin-bottom: 12px; }
  .oc-total { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--yellow); }
  .oc-note { font-size: 0.82rem; color: #aaa; margin-bottom: 10px; }
  .new-badge { background: var(--red); color: #fff; font-size: 0.68rem; font-weight: 700; letter-spacing: 1px; padding: 3px 8px; border-radius: 2px; text-transform: uppercase; animation: pulse 1.5s infinite; margin-left: 10px; }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }

  /* BIN ID SETUP BOX */
  .bin-id-box {
    display: none;
    background: #0a1a0a;
    border: 2px solid #166534;
    border-radius: 8px;
    padding: 16px;
  }
  .bin-id-box-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; color: #4ade80; font-weight: 700; margin-bottom: 8px; }
  .bin-id-box p { font-size: 0.78rem; color: #aaa; margin-bottom: 10px; line-height: 1.5; }
  .bin-id-value { background: #111; border: 1px solid #1a3a1a; border-radius: 4px; padding: 8px 10px; font-family: monospace; font-size: 0.78rem; color: #4ade80; word-break: break-all; margin-bottom: 10px; }
  .copy-bin-btn { width: 100%; background: #166534; color: #fff; border: none; padding: 8px; border-radius: 4px; font-weight: 700; cursor: pointer; font-size: 0.8rem; font-family: "DM Sans", sans-serif; }
  .copy-bin-btn:hover { background: #15803d; }

  /* ORDER STATUS BUTTONS */
  .status-btns { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 14px; }
  .status-btn {
    flex: 1; min-width: 80px; padding: 7px 6px; border: 1px solid #333;
    border-radius: 4px; font-size: 0.72rem; font-weight: 700; cursor: pointer;
    font-family: 'DM Sans', sans-serif; letter-spacing: 0.5px; text-transform: uppercase;
    background: #1e1e1e; color: var(--muted); transition: all 0.2s;
  }
  .status-btn:hover { border-color: var(--yellow); color: var(--yellow); }
  .status-btn.active-received  { background: #1e3a5f; border-color: #3b82f6; color: #93c5fd; }
  .status-btn.active-preparing { background: #3a2a00; border-color: var(--yellow); color: var(--yellow); }
  .status-btn.active-ontheway  { background: #1a2a00; border-color: #84cc16; color: #bef264; }
  .status-btn.active-delivered { background: #0a2a0a; border-color: #22c55e; color: #4ade80; }
  .oc-status-badge {
    display: inline-block; padding: 3px 10px; border-radius: 20px;
    font-size: 0.72rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 10px;
  }
  .badge-received  { background: #1e3a5f; color: #93c5fd; }
  .badge-preparing { background: #3a2a00; color: var(--yellow); }
  .badge-ontheway  { background: #1a2a00; color: #bef264; }
  .badge-delivered { background: #0a2a0a; color: #4ade80; }

  /* CLEAR BTN */
  .clear-btn { background: none; border: 1px solid #2a2a2a; color: #555; padding: 6px 14px; border-radius: 4px; cursor: pointer; font-family: 'DM Sans', sans-serif; font-size: 0.75rem; font-weight: 600; transition: all 0.2s; }
  .clear-btn:hover { border-color: var(--red); color: var(--red); }

  @media (max-width: 768px) {
    .admin-body { grid-template-columns: 1fr; }
    header { padding: 16px 20px; }
    .sidebar { border-right: none; border-bottom: 1px solid #1e1e1e; }
    .orders-panel { padding: 20px; }
  }
</style>
</head>
<body>

<header>
  <div class="admin-logo">CESS TUNA <span>Admin Panel</span></div>
  <a href="index.html" class="view-site-btn" target="_blank">üåê View Customer Site</a>
</header>

<div class="admin-body">

  <!-- SIDEBAR -->
  <aside class="sidebar">

    <!-- KILL SWITCH -->
    <div class="kill-card" id="killCard">
      <div class="kill-title">‚ö° Site Kill Switch</div>
      <p class="kill-desc" id="killDesc">Toggle this to shut down the customer site when they haven't paid their monthly fee.</p>

      <button class="big-switch online" id="bigSwitch" onclick="handleSwitch()">
        <span id="switchIcon">üü¢</span>
        <span id="switchLabel">SITE IS LIVE</span>
      </button>

      <div class="confirm-box" id="confirmBox">
        <p>‚ö†Ô∏è This will show a CLOSED screen to all customers. Confirm shutdown?</p>
        <div class="confirm-btns">
          <button class="confirm-yes" onclick="confirmShutdown()">YES, SHUT DOWN</button>
          <button class="confirm-no"  onclick="cancelShutdown()">Cancel</button>
        </div>
      </div>

      <div>
        <span class="status-pill live" id="statusPill">
          <span class="status-dot live" id="statusDot"></span>
          <span id="statusText">Site Online</span>
        </span>
      </div>
    </div>

    <!-- STATS -->
    <div class="stats-card">
      <div class="stats-title">üìä Today's Stats</div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-num" id="statOrders">0</div>
          <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-item">
          <div class="stat-num" id="statRevenue">0</div>
          <div class="stat-label">Revenue (‚Ç±)</div>
        </div>
      </div>
    </div>

    <!-- BIN ID SETUP (shows on first load) -->
    <div class="bin-id-box" id="binIdBox">
      <div class="bin-id-box-title">‚úÖ Setup Complete!</div>
      <p>Your online storage bin was created. Send this ID to your developer so they can update <strong>index.html</strong>:</p>
      <div class="bin-id-value" id="binIdValue">loading...</div>
      <button class="copy-bin-btn" onclick="copyBinId()">üìã Copy Bin ID</button>
    </div>

    <!-- CLEAR ORDERS -->
    <button class="clear-btn" onclick="clearOrders()">üóë Clear All Orders</button>

  </aside>

  <!-- ORDERS -->
  <main class="orders-panel">
    <div class="panel-header">
      <div class="panel-title">INCOMING <span>ORDERS</span></div>
      <button class="refresh-btn" onclick="loadOrders()">‚Üª Refresh</button>
    </div>
    <div id="ordersList"></div>
  </main>

</div>

<script>
  const API_KEY      = '$2a$10$VgEOzGTqUc4FOjCZulSrI.AE50EZQuuiTxtV9ONIyyFYOVTlBCjXK';
  const SHUTDOWN_BIN = '699db35843b1c97be999be52';
  const ORDERS_BIN   = '699db83cd0ea881f40d53452';
  let isShutdown = false;
  let allOrders  = [];

  const STATUS_LABELS = {
    received:  'üì• Order Received',
    preparing: 'üë®‚Äçüç≥ Preparing',
    ontheway:  'üõµ On the Way',
    delivered: '‚úÖ Delivered'
  };

  async function init() {
    await fetchState();
    await loadOrders();
    setInterval(fetchState, 5000);
    setInterval(loadOrders, 8000);
  }

  // ‚îÄ‚îÄ SHUTDOWN ‚îÄ‚îÄ
  async function fetchState() {
    try {
      const res  = await fetch('https://api.jsonbin.io/v3/b/' + SHUTDOWN_BIN + '/latest', {
        headers: { 'X-Master-Key': API_KEY, 'X-Access-Key': API_KEY }
      });
      const data = await res.json();
      isShutdown = data.record && data.record.shutdown === true;
      applyState();
    } catch(e) {}
  }

  async function saveState(value) {
    try {
      await fetch('https://api.jsonbin.io/v3/b/' + SHUTDOWN_BIN, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY, 'X-Access-Key': API_KEY },
        body: JSON.stringify({ shutdown: value })
      });
    } catch(e) {}
  }

  function handleSwitch() {
    if (!isShutdown) {
      document.getElementById('confirmBox').style.display = 'block';
      document.getElementById('switchLabel').textContent = 'CONFIRM BELOW...';
    } else {
      isShutdown = false;
      saveState(false);
      applyState();
    }
  }

  async function confirmShutdown() {
    document.getElementById('confirmBox').style.display = 'none';
    isShutdown = true;
    await saveState(true);
    applyState();
  }

  function cancelShutdown() {
    document.getElementById('confirmBox').style.display = 'none';
    applyState();
  }

  function applyState() {
    const card = document.getElementById('killCard');
    const btn  = document.getElementById('bigSwitch');
    const icon = document.getElementById('switchIcon');
    const label = document.getElementById('switchLabel');
    const desc = document.getElementById('killDesc');
    const pill = document.getElementById('statusPill');
    const dot  = document.getElementById('statusDot');
    const statusTxt = document.getElementById('statusText');
    if (isShutdown) {
      card.classList.add('shutdown'); btn.className = 'big-switch offline';
      icon.textContent = 'üî¥'; label.textContent = 'SITE IS SHUT DOWN ‚Äî CLICK TO RESTORE';
      desc.className = 'kill-desc danger';
      desc.textContent = 'üî¥ Customers are seeing the CLOSED screen.';
      pill.className = 'status-pill down'; dot.className = 'status-dot down';
      statusTxt.textContent = 'Site Offline';
    } else {
      card.classList.remove('shutdown'); btn.className = 'big-switch online';
      icon.textContent = 'üü¢'; label.textContent = 'SITE IS LIVE ‚Äî CLICK TO SHUT DOWN';
      desc.className = 'kill-desc';
      desc.textContent = "Toggle this to shut down the site when they haven't paid.";
      pill.className = 'status-pill live'; dot.className = 'status-dot live';
      statusTxt.textContent = 'Site Online';
    }
  }

  // ‚îÄ‚îÄ ORDERS ‚îÄ‚îÄ
  async function loadOrders() {
    const list = document.getElementById('ordersList');
    try {
      const res  = await fetch('https://api.jsonbin.io/v3/b/' + ORDERS_BIN + '/latest', {
        headers: { 'X-Master-Key': API_KEY, 'X-Access-Key': API_KEY }
      });
      const data = await res.json();
      allOrders = (data.record && data.record.orders) ? data.record.orders : [];

      document.getElementById('statOrders').textContent = allOrders.length;
      document.getElementById('statRevenue').textContent = allOrders.reduce((s,o) => s+o.total, 0).toLocaleString();

      if (allOrders.length === 0) {
        list.innerHTML = '<div class="no-orders"><div class="no-orders-icon">üçî</div>No orders yet.<br>Waiting for customers...</div>';
        return;
      }

      list.innerHTML = allOrders.map((o, i) => {
        const status = o.status || 'received';
        const badgeClass = 'badge-' + status;
        const statusLabel = STATUS_LABELS[status] || STATUS_LABELS.received;
        return `
        <div class="order-card ${i === 0 && status === 'received' ? 'new-order' : ''}">
          <div class="oc-header">
            <div>
              <span class="oc-id">${o.orderId}</span>
              ${i === 0 && status === 'received' ? '<span class="new-badge">NEW</span>' : ''}
            </div>
            <div class="oc-time">${o.time}</div>
          </div>
          <div class="oc-status-badge ${badgeClass}">${statusLabel}</div>
          <div class="oc-customer">üë§ ${o.name} &nbsp;¬∑&nbsp; üìû ${o.phone}</div>
          <div class="oc-address">üìç ${o.address}</div>
          <div class="oc-items">${o.items.map(item => item.emoji + ' ' + item.name + ' √ó' + item.qty).join('<br>')}</div>
          ${o.note ? '<div class="oc-note">üìù ' + o.note + '</div>' : ''}
          <div class="oc-total" style="margin-bottom:12px;">Total: &#8369;${o.total.toLocaleString()}.00</div>
          <div class="status-btns">
            <button class="status-btn ${status==='received' ? 'active-received' : ''}"   onclick="updateStatus(${i}, 'received')">üì• Received</button>
            <button class="status-btn ${status==='preparing' ? 'active-preparing' : ''}" onclick="updateStatus(${i}, 'preparing')">üë®‚Äçüç≥ Preparing</button>
            <button class="status-btn ${status==='ontheway' ? 'active-ontheway' : ''}"   onclick="updateStatus(${i}, 'ontheway')">üõµ On the Way</button>
            <button class="status-btn ${status==='delivered' ? 'active-delivered' : ''}" onclick="updateStatus(${i}, 'delivered')">‚úÖ Delivered</button>
          </div>
        </div>`;
      }).join('');
    } catch(e) {
      list.innerHTML = '<div class="no-orders">‚ö†Ô∏è Could not load orders.</div>';
    }
  }

  async function updateStatus(index, newStatus) {
    allOrders[index].status = newStatus;
    try {
      await fetch('https://api.jsonbin.io/v3/b/' + ORDERS_BIN, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY, 'X-Access-Key': API_KEY },
        body: JSON.stringify({ orders: allOrders })
      });
      loadOrders();
    } catch(e) {}
  }

  async function clearOrders() {
    if (!confirm('Clear all orders? This cannot be undone.')) return;
    try {
      await fetch('https://api.jsonbin.io/v3/b/' + ORDERS_BIN, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', 'X-Master-Key': API_KEY, 'X-Access-Key': API_KEY },
        body: JSON.stringify({ orders: [] })
      });
      loadOrders();
    } catch(e) {}
  }

  init();
</script>
</body>
</html>
